<!DOCTYPE html>
<script src="/env.js"></script>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ultra Agent OS - Admin Control Plane</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #0F172A;
  --secondary: #1E293B;
  --accent: #2563EB;
  --success: #16A34A;
  --warning: #D97706;
  --error: #DC2626;
  --background: #020617;
  --surface: #020617;
  --text-primary: #E5E7EB;
  --text-secondary: #9CA3AF;
  --border: rgba(148, 163, 184, 0.1);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', system-ui, sans-serif;
  background: var(--background);
  color: var(--text-primary);
  font-weight: 400;
  line-height: 1.5;
}

#root {
  display: grid;
  grid-template-columns: 300px 1fr 350px;
  grid-template-rows: 60px 1fr 200px;
  height: 100vh;
  gap: 1px;
  background: var(--border);
}

.header {
  grid-column: 1 / -1;
  background: var(--secondary);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 20px;
  justify-content: space-between;
}

.header h1 {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
}

.header-actions {
  display: flex;
  gap: 10px;
}

.btn {
  padding: 6px 12px;
  border: 1px solid var(--border);
  background: var(--primary);
  color: var(--text-primary);
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.btn:hover {
  background: var(--accent);
  color: white;
}

.btn.danger {
  background: var(--error);
  color: white;
}

.btn.success {
  background: var(--success);
  color: white;
}

.panel {
  background: var(--surface);
  display: flex;
  flex-direction: column;
}

#navigation {
  border-right: 1px solid var(--border);
}

#main-content {
  background: var(--primary);
}

#system-status {
  border-left: 1px solid var(--border);
}

#logs {
  grid-column: 1 / -1;
  border-top: 1px solid var(--border);
  background: var(--secondary);
}

.panel-header {
  padding: 16px 20px;
  border-bottom: 1px solid var(--border);
  background: var(--secondary);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.panel-header h3 {
  font-size: 14px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-secondary);
  margin: 0;
}

.panel-content {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.nav-item {
  padding: 12px 20px;
  cursor: pointer;
  border-left: 3px solid transparent;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 10px;
}

.nav-item:hover {
  background: var(--secondary);
}

.nav-item.active {
  background: var(--secondary);
  border-left-color: var(--accent);
  color: var(--accent);
}

.nav-icon {
  width: 16px;
  height: 16px;
  opacity: 0.7;
}

.status-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  display: inline-block;
  margin-right: 8px;
}

.status-online {
  background: var(--success);
  box-shadow: 0 0 4px var(--success);
}

.status-offline {
  background: var(--error);
  box-shadow: 0 0 4px var(--error);
}

.status-warning {
  background: var(--warning);
  box-shadow: 0 0 4px var(--warning);
}

.metric-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 16px;
}

.metric-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.metric-title {
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--text-secondary);
}

.metric-value {
  font-size: 24px;
  font-weight: 600;
  color: var(--text-primary);
}

.metric-change {
  font-size: 12px;
  font-weight: 500;
}

.metric-change.positive {
  color: var(--success);
}

.metric-change.negative {
  color: var(--error);
}

.job-item {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.job-item:hover {
  border-color: var(--accent);
}

.job-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.job-id {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  color: var(--text-secondary);
}

.job-status {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
}

.job-status.pending {
  background: var(--warning);
  color: white;
}

.job-status.running {
  background: var(--accent);
  color: white;
}

.job-status.completed {
  background: var(--success);
  color: white;
}

.job-status.failed {
  background: var(--error);
  color: white;
}

.job-message {
  font-size: 14px;
  color: var(--text-primary);
  margin-bottom: 8px;
}

.job-meta {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: var(--text-secondary);
}

.log-container {
  height: 100%;
  overflow-y: auto;
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  line-height: 1.4;
}

.log-entry {
  padding: 4px 8px;
  border-bottom: 1px solid var(--border);
  display: flex;
  gap: 8px;
}

.log-timestamp {
  color: var(--text-secondary);
  min-width: 80px;
}

.log-level {
  min-width: 60px;
  font-weight: 600;
}

.log-level.INFO {
  color: var(--text-primary);
}

.log-level.WARN {
  color: var(--warning);
}

.log-level.ERROR {
  color: var(--error);
}

.log-message {
  flex: 1;
  color: var(--text-primary);
}

.config-section {
  margin-bottom: 24px;
}

.config-section h4 {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 12px;
  color: var(--text-primary);
}

.config-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid var(--border);
}

.config-label {
  font-size: 12px;
  color: var(--text-secondary);
}

.config-value {
  font-size: 12px;
  color: var(--text-primary);
  font-family: 'JetBrains Mono', monospace;
}

.config-toggle {
  position: relative;
  width: 40px;
  height: 20px;
  background: var(--secondary);
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.2s ease;
}

.config-toggle.active {
  background: var(--accent);
}

.config-toggle::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 2px;
  width: 16px;
  height: 16px;
  background: white;
  border-radius: 50%;
  transition: transform 0.2s ease;
}

.config-toggle.active::after {
  transform: translateX(20px);
}

.user-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  border-bottom: 1px solid var(--border);
}

.user-info {
  flex: 1;
}

.user-name {
  font-size: 14px;
  font-weight: 500;
  color: var(--text-primary);
}

.user-role {
  font-size: 12px;
  color: var(--text-secondary);
}

.user-actions {
  display: flex;
  gap: 8px;
}

.loading {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 200px;
  color: var(--text-secondary);
}

.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid var(--border);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-right: 12px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.hidden {
  display: none;
}

.form-group {
  margin-bottom: 16px;
}

.form-label {
  display: block;
  font-size: 12px;
  font-weight: 500;
  margin-bottom: 6px;
  color: var(--text-secondary);
}

.form-input {
  width: 100%;
  padding: 8px 12px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--text-primary);
  font-size: 14px;
}

.form-input:focus {
  outline: none;
  border-color: var(--accent);
}

.modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-content {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 24px;
  max-width: 400px;
  width: 90%;
}

.modal-header {
  margin-bottom: 20px;
}

.modal-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
}

.modal-body {
  margin-bottom: 20px;
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}
</style>
</head>
<body>
<div id="root">
  <!-- Header -->
  <div class="header">
    <h1>Ultra Agent OS - Admin Control Plane</h1>
    <div class="header-actions">
      <button class="btn" onclick="refreshData()">Refresh</button>
      <button class="btn danger" onclick="logout()">Logout</button>
    </div>
  </div>

  <!-- Navigation Panel -->
  <div id="navigation" class="panel">
    <div class="panel-content">
      <div class="nav-item active" data-view="dashboard" onclick="showView('dashboard')">
        <span class="nav-icon">üìä</span>
        <span>Dashboard</span>
      </div>
      <div class="nav-item" data-view="jobs" onclick="showView('jobs')">
        <span class="nav-icon">‚ö°</span>
        <span>Jobs</span>
      </div>
      <div class="nav-item" data-view="users" onclick="showView('users')">
        <span class="nav-icon">üë•</span>
        <span>Users</span>
      </div>
      <div class="nav-item" data-view="system" onclick="showView('system')">
        <span class="nav-icon">‚öôÔ∏è</span>
        <span>System</span>
      </div>
      <div class="nav-item" data-view="config" onclick="showView('config')">
        <span class="nav-icon">üîß</span>
        <span>Configuration</span>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div id="main-content" class="panel">
    <div class="panel-header">
      <h3 id="view-title">Dashboard</h3>
      <div id="view-actions"></div>
    </div>
    <div class="panel-content" id="view-content">
      <!-- Dynamic content will be loaded here -->
    </div>
  </div>

  <!-- System Status Panel -->
  <div id="system-status" class="panel">
    <div class="panel-header">
      <h3>System Status</h3>
      <span class="status-indicator" id="system-status-indicator"></span>
    </div>
    <div class="panel-content" id="system-status-content">
      <div class="loading">
        <div class="spinner"></div>
        Loading system status...
      </div>
    </div>
  </div>

  <!-- Logs Panel -->
  <div id="logs" class="panel">
    <div class="panel-header">
      <h3>Live Logs</h3>
      <button class="btn" onclick="clearLogs()">Clear</button>
    </div>
    <div class="log-container" id="log-container">
      <!-- Logs will be displayed here -->
    </div>
  </div>
</div>

<!-- Modals -->
<div id="modal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title" id="modal-title">Modal Title</h3>
    </div>
    <div class="modal-body" id="modal-body">
      <!-- Modal content -->
    </div>
    <div class="modal-footer">
      <button class="btn" onclick="closeModal()">Cancel</button>
      <button class="btn success" id="modal-confirm" onclick="confirmModal()">Confirm</button>
    </div>
  </div>
</div>

<script>
class AdminControlPlane {
  constructor() {
    this.authToken = null;
    this.currentView = 'dashboard';
    this.websocket = null;
    this.refreshInterval = null;
    this.systemData = {};
    
    this.init();
  }

  async init() {
    this.authToken = localStorage.getItem('authToken');
    if (!this.authToken) {
      this.showLoginModal();
    } else {
      await this.loadWorkspace();
      this.connectWebSocket();
      this.startAutoRefresh();
    }
  }

  async login(username, password) {
    try {
      const response = await fetch(`${window.API_URL}/api/auth/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });
      
      if (response.ok) {
        const data = await response.json();
        this.authToken = data.token;
        localStorage.setItem('authToken', this.authToken);
        closeModal();
        await this.loadWorkspace();
        this.connectWebSocket();
        this.startAutoRefresh();
      } else {
        throw new Error('Login failed');
      }
    } catch (error) {
      console.error('Login error:', error);
      alert('Login failed. Please check your credentials.');
    }
  }

  logout() {
    localStorage.removeItem('authToken');
    this.authToken = null;
    if (this.websocket) {
      this.websocket.close();
    }
    if (this.refreshInterval) {
      clearInterval(this.refreshInterval);
    }
    this.showLoginModal();
  }

  showLoginModal() {
    const modal = document.getElementById('modal');
    const title = document.getElementById('modal-title');
    const body = document.getElementById('modal-body');
    
    title.textContent = 'Admin Login';
    body.innerHTML = `
      <div class="form-group">
        <label class="form-label">Username</label>
        <input type="text" class="form-input" id="login-username" value="admin">
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input type="password" class="form-input" id="login-password">
      </div>
    `;
    
    modal.classList.remove('hidden');
    document.getElementById('modal-confirm').onclick = () => {
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;
      this.login(username, password);
    };
  }

  async loadWorkspace() {
    try {
      const response = await fetch(`${window.API_URL}/api/workspace`, {
        headers: { 'Authorization': `Bearer ${this.authToken}` }
      });
      
      if (response.ok) {
        this.systemData = await response.json();
        this.updateSystemStatus();
        this.loadCurrentView();
      }
    } catch (error) {
      console.error('Failed to load workspace:', error);
    }
  }

  connectWebSocket() {
    const wsPort = window.WS_PORT || 3011;
    const wsUrl = (window.API_URL.replace(/^http/, 'ws').replace(/:\d+/, '') || 'ws://localhost') + ':' + wsPort;
    this.websocket = new WebSocket(wsUrl);
    
    this.websocket.onopen = () => {
      console.log('WebSocket connected');
      this.addLog('INFO', 'WebSocket connected to admin control plane');
    };
    
    this.websocket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      this.handleWebSocketMessage(data);
    };
    
    this.websocket.onclose = () => {
      console.log('WebSocket disconnected');
      this.addLog('WARN', 'WebSocket disconnected, attempting reconnect...');
      setTimeout(() => this.connectWebSocket(), 5000);
    };
    
    this.websocket.onerror = (error) => {
      console.error('WebSocket error:', error);
      this.addLog('ERROR', 'WebSocket connection error');
    };
  }

  handleWebSocketMessage(data) {
    if (data.type === 'log') {
      this.addLog(data.level || 'INFO', data.message);
    } else if (data.type === 'job_status') {
      this.updateJobStatus(data.jobId, data);
    } else if (data.type === 'system_status') {
      this.updateSystemStatus(data);
    }
  }

  addLog(level, message) {
    const container = document.getElementById('log-container');
    const timestamp = new Date().toLocaleTimeString();
    
    const logEntry = document.createElement('div');
    logEntry.className = 'log-entry';
    logEntry.innerHTML = `
      <span class="log-timestamp">${timestamp}</span>
      <span class="log-level ${level}">${level}</span>
      <span class="log-message">${message}</span>
    `;
    
    container.appendChild(logEntry);
    container.scrollTop = container.scrollHeight;
    
    // Keep only last 100 logs
    while (container.children.length > 100) {
      container.removeChild(container.firstChild);
    }
  }

  clearLogs() {
    document.getElementById('log-container').innerHTML = '';
    this.addLog('INFO', 'Logs cleared by admin');
  }

  startAutoRefresh() {
    this.refreshInterval = setInterval(() => {
      this.loadWorkspace();
    }, 30000); // Refresh every 30 seconds
  }

  showView(viewName) {
    this.currentView = viewName;
    
    // Update navigation
    document.querySelectorAll('.nav-item').forEach(item => {
      item.classList.remove('active');
    });
    document.querySelector(`[data-view="${viewName}"]`).classList.add('active');
    
    // Update header
    document.getElementById('view-title').textContent = viewName.charAt(0).toUpperCase() + viewName.slice(1);
    
    // Load view content
    this.loadCurrentView();
  }

  loadCurrentView() {
    const content = document.getElementById('view-content');
    
    switch (this.currentView) {
      case 'dashboard':
        this.loadDashboard(content);
        break;
      case 'jobs':
        this.loadJobs(content);
        break;
      case 'users':
        this.loadUsers(content);
        break;
      case 'system':
        this.loadSystem(content);
        break;
      case 'config':
        this.loadConfig(content);
        break;
    }
  }

  loadDashboard(container) {
    container.innerHTML = `
      <div class="metric-card">
        <div class="metric-header">
          <span class="metric-title">Total Jobs</span>
          <span class="metric-change positive">+12%</span>
        </div>
        <div class="metric-value">${this.systemData.totalJobs || 0}</div>
      </div>
      
      <div class="metric-card">
        <div class="metric-header">
          <span class="metric-title">Active Jobs</span>
          <span class="metric-change positive">+5%</span>
        </div>
        <div class="metric-value">${this.systemData.activeJobs || 0}</div>
      </div>
      
      <div class="metric-card">
        <div class="metric-header">
          <span class="metric-title">Success Rate</span>
          <span class="metric-change positive">98.5%</span>
        </div>
        <div class="metric-value">${this.systemData.successRate || 0}%</div>
      </div>
      
      <div class="metric-card">
        <div class="metric-header">
          <span class="metric-title">Queue Depth</span>
          <span class="metric-change negative">+3</span>
        </div>
        <div class="metric-value">${this.systemData.queueDepth || 0}</div>
      </div>
    `;
  }

  loadJobs(container) {
    const jobs = this.systemData.jobs || [];
    
    if (jobs.length === 0) {
      container.innerHTML = '<div class="loading">No jobs found</div>';
      return;
    }
    
    container.innerHTML = jobs.map(job => `
      <div class="job-item" onclick="admin.selectJob('${job.id}')">
        <div class="job-header">
          <span class="job-id">${job.id.substring(0, 8)}...</span>
          <span class="job-status ${job.status}">${job.status}</span>
        </div>
        <div class="job-message">${job.message}</div>
        <div class="job-meta">
          <span>Created: ${new Date(job.created_at).toLocaleString()}</span>
          <span>Type: ${job.type}</span>
        </div>
      </div>
    `).join('');
  }

  loadUsers(container) {
    const users = this.systemData.users || [];
    
    container.innerHTML = users.map(user => `
      <div class="user-item">
        <div class="user-info">
          <div class="user-name">${user.username}</div>
          <div class="user-role">${user.role}</div>
        </div>
        <div class="user-actions">
          <button class="btn" onclick="admin.editUser('${user.id}')">Edit</button>
          <button class="btn danger" onclick="admin.deleteUser('${user.id}')">Delete</button>
        </div>
      </div>
    `).join('');
  }

  loadSystem(container) {
    container.innerHTML = `
      <div class="config-section">
        <h4>System Information</h4>
        <div class="config-item">
          <span class="config-label">Version</span>
          <span class="config-value">1.0.0</span>
        </div>
        <div class="config-item">
          <span class="config-label">Uptime</span>
          <span class="config-value">${this.systemData.uptime || 'Unknown'}</span>
        </div>
        <div class="config-item">
          <span class="config-label">Environment</span>
          <span class="config-value">${this.systemData.environment || 'Unknown'}</span>
        </div>
      </div>
      
      <div class="config-section">
        <h4>Resource Usage</h4>
        <div class="config-item">
          <span class="config-label">Memory Usage</span>
          <span class="config-value">${this.systemData.memoryUsage || 'Unknown'}</span>
        </div>
        <div class="config-item">
          <span class="config-label">CPU Usage</span>
          <span class="config-value">${this.systemData.cpuUsage || 'Unknown'}</span>
        </div>
        <div class="config-item">
          <span class="config-label">Disk Usage</span>
          <span class="config-value">${this.systemData.diskUsage || 'Unknown'}</span>
        </div>
      </div>
    `;
  }

  loadConfig(container) {
    container.innerHTML = `
      <div class="config-section">
        <h4>Adapter Configuration</h4>
        <div class="config-item">
          <span class="config-label">LLM Adapter</span>
          <div class="config-toggle ${this.systemData.adapters?.ollama?.available ? 'active' : ''}" 
               onclick="admin.toggleAdapter('ollama')"></div>
        </div>
        <div class="config-item">
          <span class="config-label">Docker Adapter</span>
          <div class="config-toggle ${this.systemData.adapters?.docker?.available ? 'active' : ''}" 
               onclick="admin.toggleAdapter('docker')"></div>
        </div>
      </div>
      
      <div class="config-section">
        <h4>Security Settings</h4>
        <div class="config-item">
          <span class="config-label">Rate Limiting</span>
          <div class="config-toggle active" onclick="admin.toggleSetting('rateLimit')"></div>
        </div>
        <div class="config-item">
          <span class="config-label">Audit Logging</span>
          <div class="config-toggle active" onclick="admin.toggleSetting('auditLog')"></div>
        </div>
      </div>
      
      <div class="config-section">
        <h4>System Actions</h4>
        <button class="btn" onclick="admin.rotateSecrets()">Rotate Secrets</button>
        <button class="btn danger" onclick="admin.restartSystem()">Restart System</button>
      </div>
    `;
  }

  updateSystemStatus() {
    const statusContent = document.getElementById('system-status-content');
    const statusIndicator = document.getElementById('system-status-indicator');
    
    if (!this.systemData.adapters) {
      statusContent.innerHTML = '<div class="loading">Loading system status...</div>';
      return;
    }
    
    let statusClass = 'status-online';
    let statusText = 'All Systems Operational';
    
    if (!this.systemData.adapters.database.available || !this.systemData.adapters.redis.available) {
      statusClass = 'status-offline';
      statusText = 'Critical Systems Offline';
    } else if (!this.systemData.adapters.ollama.available || !this.systemData.adapters.docker.available) {
      statusClass = 'status-warning';
      statusText = 'Some Adapters Offline';
    }
    
    statusIndicator.className = `status-indicator ${statusClass}`;
    
    statusContent.innerHTML = `
      <div class="config-item">
        <span class="config-label">Database</span>
        <span class="config-value">
          <span class="status-indicator ${this.systemData.adapters.database.available ? 'status-online' : 'status-offline'}"></span>
          ${this.systemData.adapters.database.status || 'Unknown'}
        </span>
      </div>
      <div class="config-item">
        <span class="config-label">Redis</span>
        <span class="config-value">
          <span class="status-indicator ${this.systemData.adapters.redis.available ? 'status-online' : 'status-offline'}"></span>
          ${this.systemData.adapters.redis.status || 'Unknown'}
        </span>
      </div>
      <div class="config-item">
        <span class="config-label">LLM Adapter</span>
        <span class="config-value">
          <span class="status-indicator ${this.systemData.adapters.ollama.available ? 'status-online' : 'status-warning'}"></span>
          ${this.systemData.adapters.ollama.status || 'Unavailable'}
        </span>
      </div>
      <div class="config-item">
        <span class="config-label">Docker Adapter</span>
        <span class="config-value">
          <span class="status-indicator ${this.systemData.adapters.docker.available ? 'status-online' : 'status-warning'}"></span>
          ${this.systemData.adapters.docker.status || 'Unavailable'}
        </span>
      </div>
      <div class="config-item">
        <span class="config-label">Overall Status</span>
        <span class="config-value">${statusText}</span>
      </div>
    `;
  }

  async toggleAdapter(adapterName) {
    this.addLog('INFO', `Toggling ${adapterName} adapter`);
    await this.loadWorkspace();
  }

  async toggleSetting(settingName) {
    this.addLog('INFO', `Toggling ${settingName} setting`);
    await this.loadWorkspace();
  }

  async rotateSecrets() {
    if (confirm('Are you sure you want to rotate all secrets? This will invalidate all existing sessions.')) {
      this.addLog('WARN', 'Initiating secret rotation...');
      await this.loadWorkspace();
    }
  }

  async restartSystem() {
    if (confirm('Are you sure you want to restart the system? This will interrupt all running jobs.')) {
      this.addLog('WARN', 'Initiating system restart...');
    }
  }

  selectJob(jobId) {
    this.addLog('INFO', `Selected job: ${jobId}`);
  }

  editUser(userId) {
    this.addLog('INFO', `Editing user: ${userId}`);
  }

  async deleteUser(userId) {
    if (confirm('Are you sure you want to delete this user?')) {
      this.addLog('WARN', `Deleting user: ${userId}`);
      await this.loadWorkspace();
    }
  }
}

// Global functions
let admin;

function showView(viewName) {
  admin.showView(viewName);
}

function refreshData() {
  admin.loadWorkspace();
  admin.addLog('INFO', 'Data refreshed by admin');
}

function logout() {
  admin.logout();
}

function clearLogs() {
  admin.clearLogs();
}

function closeModal() {
  document.getElementById('modal').classList.add('hidden');
}

function confirmModal() {
  // Handle modal confirmation
}

// Initialize admin control plane
document.addEventListener('DOMContentLoaded', () => {
  admin = new AdminControlPlane();
});
</script>
</body>
</html>
