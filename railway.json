{
  "$schema": "https://railway.app/railway.schema.json",
  "name": "Ultra Agent OS",
  "description": "MiniMax-like Agent OS with API, Dashboard, Worker & Redis",
  "deploy": {
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  },
  "services": [
    {
      "name": "ultra-agent-api",
      "source": ".",
      "dockerfilePath": "Dockerfile.api",
      "environment": ["production"],
      "healthcheck": {
        "path": "/health",
        "interval": 30,
        "timeout": 10,
        "retries": 5,
        "startPeriod": 60
      },
      "dependsOn": ["redis"],
      "description": "API Backend Service - Express.js with JWT auth, WebSocket, and job management",
      "variables": {
        "NODE_ENV": "production",
        "PORT": "${{PORT}}",
        "REDIS_URL": "${{redis.REDIS_URL}}",
        "JWT_SECRET": "${{secrets.JWT_SECRET}}",
        "DATA_DIR": "/data/agent",
        "OLLAMA_URL": "http://localhost:11434",
        "WS_PORT": "3010"
      }
    },
    {
      "name": "ultra-agent-dashboard",
      "source": ".",
      "dockerfilePath": "Dockerfile.dashboard",
      "environment": ["production"],
      "healthcheck": {
        "path": "/",
        "interval": 30,
        "timeout": 10,
        "retries": 5,
        "startPeriod": 20
      },
      "dependsOn": ["ultra-agent-api"],
      "description": "Dashboard UI Service - 4-panel MiniMax-like interface",
      "variables": {
        "NODE_ENV": "production",
        "PORT": "${{PORT}}",
        "API_URL": "${{ultra-agent-api.RAILWAY_PUBLIC_URL}}"
      }
    },
    {
      "name": "ultra-agent-worker",
      "source": ".",
      "dockerfilePath": "Dockerfile.worker",
      "environment": ["production"],
      "healthcheck": {
        "command": "test -f /tmp/worker-health || (ps aux | grep -v grep | grep -E 'worker\\.js|node.*worker' > /dev/null && touch /tmp/worker-health) || exit 1",
        "interval": 15,
        "timeout": 5,
        "retries": 20,
        "startPeriod": 120
      },
      "dependsOn": ["redis", "ultra-agent-api"],
      "description": "Background Worker Service - Processes jobs with Docker isolation",
      "variables": {
        "NODE_ENV": "production",
        "REDIS_URL": "${{redis.REDIS_URL}}",
        "DATA_DIR": "/data/agent",
        "OLLAMA_URL": "http://localhost:11434",
        "DOCKER_HOST": "unix:///var/run/docker.sock"
      }
    }
  ],
  "database": {
    "redis": {
      "version": "7",
      "multiple": false,
      "generator": "REDIS"
    }
  },
  "secrets": {
    "description": "Required secrets for Ultra Agent OS deployment",
    "JWT_SECRET": "ultra-agent-os-jwt-secret-change-in-production"
  }
}
