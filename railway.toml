[project]
name = "ultra-agent-core-blueprint"

# UI Service
[[services]]
name = "ultra-agent-ui"
source = "apps/ui"
dockerfile = "Dockerfile.static"
icon = "üé®"
[services.build]
builder = "DOCKERFILE"
[services.deploy]
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
[[services.healthcheck]]
path = "/health"
interval = 30
timeout = 10
retries = 5
[[services.env]]
name = "NODE_ENV"
value = "production"
[[services.env]]
name = "PORT"
value = "3003"
[[services.env]]
name = "API_URL"
serviceRef = "ultra-agent-api"
variableRef = "RAILWAY_PUBLIC_URL"

# API Service
[[services]]
name = "ultra-agent-api"
source = "."
dockerfile = "apps/api/Dockerfile"
icon = "üöÄ"
[[services.healthcheck]]
path = "/health"
interval = 30
timeout = 10
retries = 5
[[services.env]]
name = "DATABASE_URL"
serviceRef = "Postgres"
variableRef = "DATABASE_PRIVATE_URL"
[[services.env]]
name = "REDIS_URL"
serviceRef = "Redis"
variableRef = "REDIS_PRIVATE_URL"
[[services.env]]
name = "NODE_ENV"
value = "production"
[[services.env]]
name = "HOST"
value = "0.0.0.0"
[[services.env]]
name = "PORT"
value = "8080"
[[services.env]]
name = "INTERNAL_API_KEY"
generate = true
[[services.env]]
name = "JWT_SECRET"
generate = true
[[services.env]]
name = "DATA_DIR"
value = "/data/agent"
[[services.env]]
name = "OLLAMA_URL"
value = ""
[[services.env]]
name = "DEFAULT_ADMIN_PASSWORD"
generate = true

# Worker Service
[[services]]
name = "ultra-agent-worker"
source = "."
dockerfile = "apps/worker/Dockerfile"
icon = "‚öôÔ∏è"
[[services.env]]
name = "DATABASE_URL"
serviceRef = "Postgres"
variableRef = "DATABASE_PRIVATE_URL"
[[services.env]]
name = "REDIS_URL"
serviceRef = "Redis"
variableRef = "REDIS_PRIVATE_URL"
[[services.env]]
name = "INTERNAL_API_KEY"
serviceRef = "ultra-agent-api"
variableRef = "INTERNAL_API_KEY"
[[services.env]]
name = "JWT_SECRET"
serviceRef = "ultra-agent-api"
variableRef = "JWT_SECRET"
[[services.env]]
name = "NODE_ENV"
value = "production"
[[services.env]]
name = "DATA_DIR"
value = "/data/agent"
[[services.env]]
name = "OLLAMA_URL"
value = ""

# PostgreSQL Database
[[services]]
name = "Postgres"
image = "postgres:15-alpine"
icon = "üêò"
[[services.volumes]]
mountPath = "/var/lib/postgresql/data"
name = "pg_data"
[[services.env]]
name = "POSTGRES_DB"
value = "ultra_agent_os"
[[services.env]]
name = "POSTGRES_USER"
value = "ultra_agent"
[[services.env]]
name = "POSTGRES_PASSWORD"
generate = true

# Redis Cache
[[services]]
name = "Redis"
image = "redis:7-alpine"
icon = "‚ö°"
[[services.volumes]]
mountPath = "/data"
name = "redis_data"
